define(["core/url"],function(a){function b(b,c,d){return void 0===d&&(d="edit"),a.relativeUrl("/mod/vpl/forms")+"/"+d+".json.php?id="+b+"&userId="+c+"&action="}var c={},d={reqfile:[],execfiles:[]};return c.info=function(a,c){return void 0!=d[a][c]?Promise.resolve(d[a][c]):("reqfile"==a?VPL_Util.requestAction("resetfiles","",{},b(c,"")):VPL_Util.requestAction("load","",{},b(c,"","executionfiles"))).promise().then(function(b){var e="reqfile"==a?b.files[0]:b.files;return d[a][c]=e,e})},c.save=function(a,d,e,f,g){return c.info("reqfile",a).then(function(c){c.contents=e.replace(/([ \t]*)(.*)\{\{ANSWER\}\}/i,"$1$2"+f.split("\n").join("\n$1"));var h=[c];return g&&g.forEach(function(a){h.push(a)}),VPL_Util.requestAction("save","",{files:h},b(a,d)).promise()})},c.exec=function(a,c,d,e,f){var g={ajaxurl:b(c,d),resultSet:!1,setResult:function(a){this.resultSet=!0,f(a)},close:function(){var a=this;setTimeout(function(){a.resultSet||f({execerror:M.util.get_string("execerrordetails","qtype_vplquestion")})},600)},getConsole:function(){return e},run:function(a,b,c){e.connect(b.executionURL,function(){c.close()})}};return VPL_Util.requestAction(a,"",{},g.ajaxurl).done(function(a){VPL_Util.webSocketMonitor(a,"","",g)})},{call:function(a,...b){return VPL_Util.progressBar=function(){this.setLabel=function(){},this.close=function(){},this.isClosed=function(){return!0}},c[a](...b)},langOfFile:function(a){return VPL_Util.langType(a.split(".").pop())}}});